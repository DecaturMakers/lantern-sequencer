<html>
    <head>
        <script type="text/javascript" src="http://code.jquery.com/jquery-compat-git.js"></script>
        <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
        <link rel="stylesheet" type="text/css" href="https://bgrins.github.com/spectrum/spectrum.css">
        <script type="text/javascript" src="https://bgrins.github.com/spectrum/spectrum.js"></script>
        <style type="text/css">
            #canvas{
                border:1px solid black;
            }
        </style>
    </head>
    <body>
        <canvas id="canvas" width="500" height="500" style="float:left"></canvas>
        <form class="pure-form pure-form-aligned">
            <fieldset>
                <div class="pure-control-group">
                    <label for="number_of_lanterns">Number of lanterns:</label>
                    <input type='text' id="number_of_lanterns" value="16"/><br/>
                </div>
                <div class="pure-control-group">
                    <label for="leds_per_lantern">LEDs per lantern:</label>
                    <input type='text' id="leds_per_lantern" value="4"/><br/>
                </div>
                <div class="pure-controls">
                    <div class='pure-button' onclick="render()">RENDER</div>
                </div>
            </fieldset>
        </form>
        <br/>
        <input type='text' id="colorpicker"/>
        <div style="float:clear"></div>
        <form class="pure-form">
            <textarea id="sequence" class="pure-input-1" placeholder="Milliseconds ColorColorColor" rows="10" wrap="off">
                93c47d3d85c6cc4125f6b26b93c47d3d85c6cc4125f6b26b93c47d3d85c6cc4125f6b26b93c47d3d85c6cc4125f6b26b93c47d3d85c6cc4125f6b26b93c47d3d85c6cc4125f6b26b93c47d3d85c6cc4125f6b26b93c47d3d85c6cc4125f6b26b93c47d3d85c6cc4125f6b26b93c47d3d85c6cc4125f6b26b93c47d3d85c6cc4125f6b26b93c47d3d85c6cc4125f6b26b93c47d3d85c6cc4125f6b26b93c47d3d85c6cc4125f6b26b93c47d3d85c6cc4125f6b26b93c47d3d85c6cc4125f6b26b
            </textarea>
        </form>

        <script type="text/javascript">
document.getElementById('sequence').value = document.getElementById('sequence').value.trim()
var canvas = document.getElementById('canvas');
var radius = canvas.width * 0.4;
var lantern_radius = radius/10;
var number_of_lanterns;
var leds_per_lantern;
var cx = canvas.width / 2;
var cy = canvas.height / 2;

function bytes(data, num){
    data.next = data.value.slice(0,num * 2);
    data.value = data.value.slice(num * 2);
    return data;
}

function led(canvas, x, y, start, end, color){
    var ctx = canvas.getContext( '2d' );
    ctx.fillStyle = "#" + color;
    ctx.beginPath();
    ctx.moveTo(x, y);
    ctx.arc(x, y, lantern_radius, start, end, true);
    ctx.closePath();
    ctx.fill();
}

function lantern(canvas, x, y, colors){
    for(var i = 0; i < leds_per_lantern; i++){
        var start = i/leds_per_lantern * 2 * Math.PI
            var end = start - 1/leds_per_lantern * 2 * Math.PI
            led(canvas, x, y, start, end, bytes(colors,3).next);
    }
}

function render(){
    number_of_lanterns = document.getElementById("number_of_lanterns").value;
    leds_per_lantern = document.getElementById("leds_per_lantern").value;
    var sequence = document.getElementById("sequence").value
        colors = {value: sequence};
    for(var i = 0; i < number_of_lanterns; i++){
        var angle = i * 2 * Math.PI/number_of_lanterns;
        var x = cx + Math.cos(angle) * radius;
        var y = cy + Math.sin(angle) * radius;   
        lantern(canvas, x, y, colors);
    }
}


//setTimeout(function(){color_all(ctx, "#666666");}, 2000)

// Display color picker
$("#colorpicker").spectrum({
color: "#ECC",
showInput: true,
className: "full-spectrum",
showInitial: true,
showPalette: true,
showSelectionPalette: true,
maxPaletteSize: 10,
preferredFormat: "hex",
localStorageKey: "spectrum.demo",
move: function (color) {

},
show: function () {

},
beforeShow: function () {

},
hide: function () {

      },
change: function() {

        },
palette: [
["rgb(0, 0, 0)", "rgb(67, 67, 67)", "rgb(102, 102, 102)",
    "rgb(204, 204, 204)", "rgb(217, 217, 217)","rgb(255, 255, 255)"],
    ["rgb(152, 0, 0)", "rgb(255, 0, 0)", "rgb(255, 153, 0)", "rgb(255, 255, 0)", "rgb(0, 255, 0)",
    "rgb(0, 255, 255)", "rgb(74, 134, 232)", "rgb(0, 0, 255)", "rgb(153, 0, 255)", "rgb(255, 0, 255)"], 
    ["rgb(230, 184, 175)", "rgb(244, 204, 204)", "rgb(252, 229, 205)", "rgb(255, 242, 204)", "rgb(217, 234, 211)", 
    "rgb(208, 224, 227)", "rgb(201, 218, 248)", "rgb(207, 226, 243)", "rgb(217, 210, 233)", "rgb(234, 209, 220)", 
    "rgb(221, 126, 107)", "rgb(234, 153, 153)", "rgb(249, 203, 156)", "rgb(255, 229, 153)", "rgb(182, 215, 168)", 
    "rgb(162, 196, 201)", "rgb(164, 194, 244)", "rgb(159, 197, 232)", "rgb(180, 167, 214)", "rgb(213, 166, 189)", 
    "rgb(204, 65, 37)", "rgb(224, 102, 102)", "rgb(246, 178, 107)", "rgb(255, 217, 102)", "rgb(147, 196, 125)", 
    "rgb(118, 165, 175)", "rgb(109, 158, 235)", "rgb(111, 168, 220)", "rgb(142, 124, 195)", "rgb(194, 123, 160)",
    "rgb(166, 28, 0)", "rgb(204, 0, 0)", "rgb(230, 145, 56)", "rgb(241, 194, 50)", "rgb(106, 168, 79)",
    "rgb(69, 129, 142)", "rgb(60, 120, 216)", "rgb(61, 133, 198)", "rgb(103, 78, 167)", "rgb(166, 77, 121)",
    "rgb(91, 15, 0)", "rgb(102, 0, 0)", "rgb(120, 63, 4)", "rgb(127, 96, 0)", "rgb(39, 78, 19)", 
    "rgb(12, 52, 61)", "rgb(28, 69, 135)", "rgb(7, 55, 99)", "rgb(32, 18, 77)", "rgb(76, 17, 48)"]
    ]
    });
</script>
</body>
</html>
